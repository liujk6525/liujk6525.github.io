<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://liujk6525.github.io</id>
    <title>你不是单打独斗 • Posts by &#34;ssd.pytorch&#34; tag</title>
    <link href="https://liujk6525.github.io" />
    <updated>2023-05-31T02:16:02.000Z</updated>
    <category term="Anaconda" />
    <category term="Hexo" />
    <category term="Jetson Nano" />
    <category term="Yolo-v5" />
    <category term="JupyterLab" />
    <category term="Python" />
    <category term="Jupyter Notebook" />
    <category term="Git" />
    <category term="Typora" />
    <category term="Matlab" />
    <category term="路径规划" />
    <category term="python" />
    <category term="Yolov5" />
    <category term="ssd.pytorch" />
    <entry>
        <id>https://liujk6525.github.io/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E8%B7%91%E9%80%9Assd-pytorch/</id>
        <title>跑通ssd.pytorch</title>
        <link rel="alternate" href="https://liujk6525.github.io/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E8%B7%91%E9%80%9Assd-pytorch/"/>
        <content type="html">&lt;p&gt;&lt;strong&gt;补：&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;expected-a-cuda-device-type-for-generator-but-found-cpu&#34;&gt;Expected a ‘cuda‘ device type for generator but found ‘cpu‘&lt;/h1&gt;
&lt;p&gt;后来我在服务器训练的时候，发现出bug了。原来是&lt;code&gt;Pytorch&lt;/code&gt;版本的原因，我在&lt;code&gt;faster-rcnn-pytorch&lt;/code&gt;这个项目跑的，里面有现成的VOC数据集。但是这个环境&lt;code&gt;Pytorch&lt;/code&gt;是1.9。&lt;/p&gt;
&lt;ol type=&#34;1&#34;&gt;
&lt;li&gt;&lt;p&gt;修改&lt;code&gt;/root/miniconda3/lib/python3.7/site-packages/torch/utils/data/sampler.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;generator = torch.Generator(device=&lt;span class=&#34;string&#34;&gt;&amp;#x27;cuda&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;yield&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; torch.randperm(n, generator=generator, device=&lt;span class=&#34;string&#34;&gt;&amp;#x27;cuda&amp;#x27;&lt;/span&gt;).tolist()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;修改&lt;code&gt;train.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;data_loader = data.DataLoader(dataset, args.batch_size,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                  num_workers=args.num_workers,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                  shuffle=&lt;span class=&#34;literal&#34;&gt;True&lt;/span&gt;, collate_fn=detection_collate,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                  pin_memory=&lt;span class=&#34;literal&#34;&gt;True&lt;/span&gt;, generator=torch.Generator(device=&lt;span class=&#34;string&#34;&gt;&amp;#x27;cuda&amp;#x27;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;w-pthreadpool-cpp.cc90-warningleaking-caffe2-thread-pool-after-fork.function-pthreadpool&#34;&gt;[W pthreadpool-cpp.cc:90] Warning:Leaking Caffe2 thread-pool after fork.(function pthreadpool)&lt;/h1&gt;
&lt;p&gt;线程撕裂，出现了警告，警告数量为设置的线程数量，如果把线程数改小一些，就不会有警告了，但是会影响运行速度。修改&lt;code&gt;train.py&lt;/code&gt;中的代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;data_loader = data.DataLoader(dataset, args.batch_size,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                 num_workers=args.num_workers,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                 shuffle=&lt;span class=&#34;literal&#34;&gt;True&lt;/span&gt;, collate_fn=detection_collate,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                 pin_memory=&lt;span class=&#34;literal&#34;&gt;False&lt;/span&gt;,generator=torch.Generator(device=&lt;span class=&#34;string&#34;&gt;&amp;#x27;cuda&amp;#x27;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr /&gt;
&lt;p&gt;然后我想在服务器上用&lt;code&gt;visdom&lt;/code&gt;看训练结果图，bug出现了。&lt;/p&gt;
&lt;h1 id=&#34;nameerror-name-viz-is-not-defined&#34;&gt;NameError: name ‘viz’ is not defined&lt;/h1&gt;
&lt;p&gt;修改&lt;code&gt;train.py&lt;/code&gt;中的代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; visdom&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;global&lt;/span&gt; viz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;viz = visdom.Visdom()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;assertionerror-must-define-a-window-to-update&#34;&gt;AssertionError: Must define a window to update&lt;/h1&gt;
&lt;p&gt;修改&lt;code&gt;train.py&lt;/code&gt;中的代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; args.visdom &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; iteration != &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; (iteration % epoch_size == &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    epoch += &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    update_vis_plot(epoch, loc_loss, conf_loss, epoch_plot, &lt;span class=&#34;literal&#34;&gt;None&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;legacy-autograd-function-with-non-static-forward-method-is-deprecated&#34;&gt;Legacy autograd function with non-static forward method is deprecated&lt;/h1&gt;
&lt;p&gt;原因是当前版本要求forward过程是静态的，所以需要将原代码进行修改。&lt;/p&gt;
&lt;ol type=&#34;1&#34;&gt;
&lt;li&gt;&lt;p&gt;从&lt;a href=&#34;https://github.com/sayakbanerjee1999/Single-Shot-Object-Detection-Updated/blob/master/detection.py&#34;&gt;&lt;code&gt;Single-Shot-Object-Detection-Updated&lt;/code&gt;&lt;/a&gt;下载&lt;code&gt;detect.py&lt;/code&gt;文件，并将其替换掉原来的&lt;code&gt;layers/functions/detection.py&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;修改&lt;code&gt;ssd.py&lt;/code&gt;中的代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; phase == &lt;span class=&#34;string&#34;&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        self.softmax = nn.Softmax(dim=-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        self.detect = Detect()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; self.phase == &lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        output = self.detect.apply(self.num_classes, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0.01&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0.45&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                   loc.view(loc.size(&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;), -&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;),  &lt;span class=&#34;comment&#34;&gt;# loc preds&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                   self.softmax(conf.view(-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, self.num_classes)),  &lt;span class=&#34;comment&#34;&gt;# conf preds&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                   self.priors.&lt;span class=&#34;built_in&#34;&gt;type&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;type&lt;/span&gt;(x.data))  &lt;span class=&#34;comment&#34;&gt;# default boxes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                   )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;errno-2-no-such-file-or-directory-test.txt&#34;&gt;[Errno 2] No such file or directory: ‘test.txt’&lt;/h1&gt;
&lt;p&gt;修改&lt;code&gt;eval.py&lt;/code&gt;中的代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;imgsetpath = os.path.join(args.voc_root, &lt;span class=&#34;string&#34;&gt;&amp;#x27;VOC2007&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;ImageSets&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;Main&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;&amp;#125;.txt&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr /&gt;
&lt;p&gt;做实验对比，所以需要跑通ssd，这里部署的pytroch版本，大佬项目&lt;a href=&#34;https://github.com/amdegroot/ssd.pytorch&#34;&gt;&lt;code&gt;ssd.pytorch&lt;/code&gt;&lt;/a&gt;，中间踩了不少坑，记录如下&lt;/p&gt;
&lt;p&gt;目标：ssd.pytorch&lt;/p&gt;
&lt;p&gt;环境：cuda 11.3 | pytorch 1.8.1&lt;/p&gt;
&lt;h1 id=&#34;修改xml文件的绝对路径&#34;&gt;修改xml文件的绝对路径&lt;/h1&gt;
&lt;p&gt;这是在之前的电脑打的标签，所以VOC数据集里面的标注文件.xml里面的&lt;code&gt;&amp;lt;path&amp;gt;&lt;/code&gt;值还是老路径，&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/imgs/$%7Bfiilename%7D/image-20230531102209091.png&#34;  style=&#34;zoom: 67%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;这里我更改成新的路径。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/imgs/$%7Bfiilename%7D/image-20230531102832023.png&#34;  style=&#34;zoom: 65%;&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;indexerrorinvalid-index-of-a-0-dim-tensor&#34;&gt;IndexError:invalid index of a 0-dim tensor…&lt;/h1&gt;
&lt;p&gt;修改&lt;code&gt;train.py&lt;/code&gt;中代码，&lt;code&gt;.data[0]&lt;/code&gt;写法不适用高版本的Pytorch，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;loc_loss += loss_l.item()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;conf_loss += loss_c.item()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; iteration % &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt; == &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;timer: %.4f sec.&amp;#x27;&lt;/span&gt; % (t1 - t0))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;iter &amp;#x27;&lt;/span&gt; + &lt;span class=&#34;built_in&#34;&gt;repr&lt;/span&gt;(iteration) + &lt;span class=&#34;string&#34;&gt;&amp;#x27; || Loss: %.4f ||&amp;#x27;&lt;/span&gt; % (loss.item()), end=&lt;span class=&#34;string&#34;&gt;&amp;#x27; &amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;stopinteration&#34;&gt;StopInteration…&lt;/h1&gt;
&lt;p&gt;修改&lt;code&gt;train.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    images, targets = &lt;span class=&#34;built_in&#34;&gt;next&lt;/span&gt;(batch_iterator)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;except&lt;/span&gt; StopIteration:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    batch_iterator = &lt;span class=&#34;built_in&#34;&gt;iter&lt;/span&gt;(data_loader)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    images, targets = &lt;span class=&#34;built_in&#34;&gt;next&lt;/span&gt;(batch_iterator)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;indexerror-the-shape-of-the-mask-14-8732-at-index-0does&#34;&gt;IndexError: The shape of the mask [14, 8732] at index 0does…&lt;/h1&gt;
&lt;p&gt;交换&lt;code&gt;layers/modules/multibox_loss.py&lt;/code&gt;中代码位置，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;loss_c = loss_c.view(num, -1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;loss_c[pos] = 0  # filter out pos boxes for now&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;lossnan&#34;&gt;loss：NAN&lt;/h1&gt;
&lt;p&gt;如果lr设置过高，可能会导致训练过程中loss出现NAN的情况。它默认的参数是1e-3，我这里将学习率修改为1e-4。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;parser.add_argument(&lt;span class=&#34;string&#34;&gt;&amp;#x27;--lr&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;--learning-rate&amp;#x27;&lt;/span&gt;, default=&lt;span class=&#34;number&#34;&gt;1e-4&lt;/span&gt;, &lt;span class=&#34;built_in&#34;&gt;type&lt;/span&gt;=&lt;span class=&#34;built_in&#34;&gt;float&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;警告&#34;&gt;警告&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;UserWarning: size_average and reduce args will be deprecated, please use reduction=‘sum’ instead. warnings.warn(warning.format(ret))&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在高版本的Pytorch中，&lt;code&gt;size_average&lt;/code&gt;和&lt;code&gt;reduce&lt;/code&gt;这两个参数都将不再支持，修改&lt;code&gt;multibox_loss.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;loss_l = F.smooth_l1_loss(loc_p, loc_t, reduction=&lt;span class=&#34;string&#34;&gt;&amp;#x27;sum&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;loss_c = F.cross_entropy(conf_p, targets_weighted, reduction=&lt;span class=&#34;string&#34;&gt;&amp;#x27;sum&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;UserWarning: volatile was removed and now has no effect. Use ‘with torch.no_grad():’ instead.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;版本问题，修改&lt;code&gt;ssd.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;with&lt;/span&gt; torch.no_grad():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	self.priors = Variable(self.priorbox.forward())&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;UserWarning: nn.init.xavier_uniform is now deprecated in favor of nn.init.xavier_uniform_ .init.xavier_uniform(param)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nn.init.xavier_uniform&lt;/code&gt;是以前的版本使用的，在高版本的Pytorch中已经被弃用。修改&lt;code&gt;train.py&lt;/code&gt;中代码，修改结果如下。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;xavier&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;param&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    init.xavier_uniform_(param)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以发现很多警告就是版本不匹配的问题，但我是抱着只要能运行的心态，然而&lt;code&gt;UserWarning&lt;/code&gt;又很影响观感，那就直接屏蔽它！&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; warnings&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;warnings.filterwarnings(&lt;span class=&#34;string&#34;&gt;&amp;#x27;ignore&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者命令行执行&lt;code&gt;xx.py&lt;/code&gt;脚本文件&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python -W ignore xx.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;运行train.py文件&#34;&gt;运行train.py文件&lt;/h1&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python -W ignore train.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;/imgs/$%7Bfiilename%7D/image-20230531115820400.png&#34; style=&#34;zoom: 67%;&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;参考&#34;&gt;参考&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;amdegroot/ssd.pytorch/issues/421&#34;&gt;&lt;code&gt;amdegroot/ssd.pytorch/issues/421&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_39506912/article/details/116926504?spm=1001.2014.3001.5506&#34;&gt;&lt;code&gt;SSD训练自己的数据集（pytorch版）&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/shaoxx333/p/16181651.html&#34;&gt;&lt;code&gt;Pytorch搭建SSD模型踩坑集锦&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.yii666.com/blog/407628.html&#34;&gt;&lt;code&gt;SSD训练数据集流程（学习记录）&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
</content>
        <category term="Python" />
        <category term="ssd.pytorch" />
        <updated>2023-05-31T02:16:02.000Z</updated>
    </entry>
</feed>
